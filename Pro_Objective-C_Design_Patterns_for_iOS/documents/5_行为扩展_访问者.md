## 何为访问者模式

> 表示一个作用于某对象结构中的各元素的操作。它让我们可以在不改变各元素的类的前提下定义作用于这些元素的新操作。
>
> ——《设计模式》（Addison-Wesley，1994）

访问者知道复杂结构中的每个元素，可以访问每个元素的节点，并根据元素的特征、属性或操作执行任何操作。

![访问者模式](https://blog-andy0570-1256077835.cos.ap-shanghai.myqcloud.com/site_Images/133816.png)

`Visitor` 协议声明了两个很像的 `visit*` 方法，用于访问和处理各种 `Element` 元素类型的对象。`ConcreteVisitor`（1 或 2）实现这一协议及其抽象方法。`visit*` 的操作定义了针对特定 `Element` 元素类型的适当操作。`Client` 创建 `ConcreteVisit`（1 或 2）的对象，并将其传给一个 `Element` 对象结构。`Element` 对象结构中有一个方法接受一般化的 `Visitor` 类型。继承 `Element` 的类中，所有 `acceptVisitor` 方法中的操作几乎一样，只有一条语句让 `Visitor` 对象访问发起调用的具体 `Element` 对象。实际使用的  `visit*`  消息，定义在每个具体 `Element` 类中，这是具体`Element`类之间的唯一不同之处。每当把`acceptVisitor`消息传给 `Element` 结构，这个消息就会被转发给每个节点。在运行时确定`Element`对象的实际类型，再根据实际类型决定该调用哪个  `visit*`   方法。



## 何时使用访问者模式

在以下场景，可以使用访问者模式：

* 一个复杂的对象结构包含很多其他对象，它们有不同的接口（比如组合体），但是想对这些对象实施一些依赖于其具体类型的操作。
* 需要对一个组合结构体中的对象进行很多不相关的操作，但是不想让这些操作“污染”这些对象的类。可以将相关的操作集中起来，定义在一个访问者类中，并在需要在访问者中定义的操作时使用它。
* 定义复杂结构的类很少作修改，但经常需要向其添加新的操作。

